import{g as Se,R as l,b as ce,j as i,H as Ce,r as _}from"./app-Dq6EYPoj.js";import{loadStripe as Ee}from"./index-BJ8BO89F.js";import{A as je}from"./AppLayout-g4m8Ik4_.js";/* empty css            */import"./UserIcon-DD2hX17d.js";import"./XMarkIcon-Gwb28i_S.js";import"./index-C1h9vnw_.js";var K={exports:{}},Y,Z;function Pe(){if(Z)return Y;Z=1;var r="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return Y=r,Y}var J,ee;function Oe(){if(ee)return J;ee=1;var r=Pe();function e(){}function t(){}return t.resetWarningCache=e,J=function(){function n(p,d,s,x,m,v){if(v!==r){var u=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw u.name="Invariant Violation",u}}n.isRequired=n;function a(){return n}var o={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:a,element:n,elementType:n,instanceOf:a,node:n,objectOf:a,oneOf:a,oneOfType:a,shape:a,exact:a,checkPropTypes:t,resetWarningCache:e};return o.PropTypes=o,o},J}var te;function ke(){return te||(te=1,K.exports=Oe()()),K.exports}var we=ke();const c=Se(we);function re(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(r,a).enumerable})),t.push.apply(t,n)}return t}function ne(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?re(Object(t),!0).forEach(function(n){ue(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):re(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function M(r){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?M=function(e){return typeof e}:M=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},M(r)}function ue(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Re(r,e){if(r==null)return{};var t={},n=Object.keys(r),a,o;for(o=0;o<n.length;o++)a=n[o],!(e.indexOf(a)>=0)&&(t[a]=r[a]);return t}function Ne(r,e){if(r==null)return{};var t=Re(r,e),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(r);for(a=0;a<o.length;a++)n=o[a],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(r,n)&&(t[n]=r[n])}return t}function le(r,e){return Te(r)||Ae(r,e)||_e(r,e)||Ie()}function Te(r){if(Array.isArray(r))return r}function Ae(r,e){var t=r&&(typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"]);if(t!=null){var n=[],a=!0,o=!1,p,d;try{for(t=t.call(r);!(a=(p=t.next()).done)&&(n.push(p.value),!(e&&n.length===e));a=!0);}catch(s){o=!0,d=s}finally{try{!a&&t.return!=null&&t.return()}finally{if(o)throw d}}return n}}function _e(r,e){if(r){if(typeof r=="string")return oe(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return oe(r,e)}}function oe(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}function Ie(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var y=function(e,t,n){var a=!!n,o=l.useRef(n);l.useEffect(function(){o.current=n},[n]),l.useEffect(function(){if(!a||!e)return function(){};var p=function(){o.current&&o.current.apply(o,arguments)};return e.on(t,p),function(){e.off(t,p)}},[a,t,e,o])},H=function(e){var t=l.useRef(e);return l.useEffect(function(){t.current=e},[e]),t.current},T=function(e){return e!==null&&M(e)==="object"},We=function(e){return T(e)&&typeof e.then=="function"},Ue=function(e){return T(e)&&typeof e.elements=="function"&&typeof e.createToken=="function"&&typeof e.createPaymentMethod=="function"&&typeof e.confirmCardPayment=="function"},ae="[object Object]",qe=function r(e,t){if(!T(e)||!T(t))return e===t;var n=Array.isArray(e),a=Array.isArray(t);if(n!==a)return!1;var o=Object.prototype.toString.call(e)===ae,p=Object.prototype.toString.call(t)===ae;if(o!==p)return!1;if(!o&&!n)return e===t;var d=Object.keys(e),s=Object.keys(t);if(d.length!==s.length)return!1;for(var x={},m=0;m<d.length;m+=1)x[d[m]]=!0;for(var v=0;v<s.length;v+=1)x[s[v]]=!0;var u=Object.keys(x);if(u.length!==d.length)return!1;var E=e,j=t,S=function(w){return r(E[w],j[w])};return u.every(S)},pe=function(e,t,n){return T(e)?Object.keys(e).reduce(function(a,o){var p=!T(t)||!qe(e[o],t[o]);return n.includes(o)?(p&&console.warn("Unsupported prop change: options.".concat(o," is not a mutable property.")),a):p?ne(ne({},a||{}),{},ue({},o,e[o])):a},null):null},de="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",se=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:de;if(e===null||Ue(e))return e;throw new Error(t)},Fe=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:de;if(We(e))return{tag:"async",stripePromise:Promise.resolve(e).then(function(a){return se(a,t)})};var n=se(e,t);return n===null?{tag:"empty"}:{tag:"sync",stripe:n}},Me=function(e){!e||!e._registerWrapper||!e.registerAppInfo||(e._registerWrapper({name:"react-stripe-js",version:"5.4.1"}),e.registerAppInfo({name:"react-stripe-js",version:"5.4.1",url:"https://stripe.com/docs/stripe-js/react"}))},L=l.createContext(null);L.displayName="ElementsContext";var me=function(e,t){if(!e)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(t," in an <Elements> provider."));return e},fe=function(e){var t=e.stripe,n=e.options,a=e.children,o=l.useMemo(function(){return Fe(t)},[t]),p=l.useState(function(){return{stripe:o.tag==="sync"?o.stripe:null,elements:o.tag==="sync"?o.stripe.elements(n):null}}),d=le(p,2),s=d[0],x=d[1];l.useEffect(function(){var u=!0,E=function(S){x(function(k){return k.stripe?k:{stripe:S,elements:S.elements(n)}})};return o.tag==="async"&&!s.stripe?o.stripePromise.then(function(j){j&&u&&E(j)}):o.tag==="sync"&&!s.stripe&&E(o.stripe),function(){u=!1}},[o,s,n]);var m=H(t);l.useEffect(function(){m!==null&&m!==t&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.")},[m,t]);var v=H(n);return l.useEffect(function(){if(s.elements){var u=pe(n,v,["clientSecret","fonts"]);u&&s.elements.update(u)}},[n,v,s.elements]),l.useEffect(function(){Me(s.stripe)},[s.stripe]),l.createElement(L.Provider,{value:s},a)};fe.propTypes={stripe:c.any,options:c.object};var Le=function(e){var t=l.useContext(L);return me(t,e)},De=function(){var e=Le("calls useElements()"),t=e.elements;return t};c.func.isRequired;var he=l.createContext(null);he.displayName="CheckoutContext";c.any,c.shape({clientSecret:c.oneOfType([c.string,c.instanceOf(Promise)]).isRequired,elementsOptions:c.object}).isRequired;var V=function(e){var t=l.useContext(he),n=l.useContext(L);if(t){if(n)throw new Error("You cannot wrap the part of your app that ".concat(e," in both <CheckoutProvider> and <Elements> providers."));return t}else return me(n,e)},Be=["mode"],$e=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},g=function(e,t){var n="".concat($e(e),"Element"),a=function(s){var x=s.id,m=s.className,v=s.options,u=v===void 0?{}:v,E=s.onBlur,j=s.onFocus,S=s.onReady,k=s.onChange,w=s.onEscape,O=s.onClick,N=s.onLoadError,I=s.onLoaderStart,D=s.onNetworksChange,W=s.onConfirm,A=s.onCancel,U=s.onShippingAddressChange,ye=s.onShippingRateChange,ve=s.onSavedPaymentMethodRemove,ge=s.onSavedPaymentMethodUpdate,q=V("mounts <".concat(n,">")),F="elements"in q?q.elements:null,R="checkoutState"in q?q.checkoutState:null,C=R?.type==="success"||R?.type==="loading"?R.sdk:null,be=l.useState(null),z=le(be,2),h=z[0],xe=z[1],P=l.useRef(null),B=l.useRef(null);y(h,"blur",E),y(h,"focus",j),y(h,"escape",w),y(h,"click",O),y(h,"loaderror",N),y(h,"loaderstart",I),y(h,"networkschange",D),y(h,"confirm",W),y(h,"cancel",A),y(h,"shippingaddresschange",U),y(h,"shippingratechange",ye),y(h,"savedpaymentmethodremove",ve),y(h,"savedpaymentmethodupdate",ge),y(h,"change",k);var $;S&&(e==="expressCheckout"?$=S:$=function(){S(h)}),y(h,"ready",$),l.useLayoutEffect(function(){if(P.current===null&&B.current!==null&&(F||C)){var f=null;if(C)switch(e){case"paymentForm":f=C.createPaymentFormElement();break;case"payment":f=C.createPaymentElement(u);break;case"address":if("mode"in u){var G=u.mode,Q=Ne(u,Be);if(G==="shipping")f=C.createShippingAddressElement(Q);else if(G==="billing")f=C.createBillingAddressElement(Q);else throw new Error("Invalid options.mode. mode must be 'billing' or 'shipping'.")}else throw new Error("You must supply options.mode. mode must be 'billing' or 'shipping'.");break;case"expressCheckout":f=C.createExpressCheckoutElement(u);break;case"currencySelector":f=C.createCurrencySelectorElement();break;case"taxId":f=C.createTaxIdElement(u);break;default:throw new Error("Invalid Element type ".concat(n,". You must use either the <PaymentElement />, <AddressElement options={{mode: 'shipping'}} />, <AddressElement options={{mode: 'billing'}} />, or <ExpressCheckoutElement />."))}else F&&(f=F.create(e,u));P.current=f,xe(f),f&&f.mount(B.current)}},[F,C,u]);var X=H(u);return l.useEffect(function(){if(P.current){var f=pe(u,X,["paymentRequest"]);f&&"update"in P.current&&P.current.update(f)}},[u,X]),l.useLayoutEffect(function(){return function(){if(P.current&&typeof P.current.destroy=="function")try{P.current.destroy(),P.current=null}catch{}}},[]),l.createElement("div",{id:x,className:m,ref:B})},o=function(s){V("mounts <".concat(n,">"));var x=s.id,m=s.className;return l.createElement("div",{id:x,className:m})},p=t?o:a;return p.propTypes={id:c.string,className:c.string,onChange:c.func,onBlur:c.func,onFocus:c.func,onReady:c.func,onEscape:c.func,onClick:c.func,onLoadError:c.func,onLoaderStart:c.func,onNetworksChange:c.func,onConfirm:c.func,onCancel:c.func,onShippingAddressChange:c.func,onShippingRateChange:c.func,onSavedPaymentMethodRemove:c.func,onSavedPaymentMethodUpdate:c.func,options:c.object},p.displayName=n,p.__elementType=e,p},b=typeof window>"u",Ke=l.createContext(null);Ke.displayName="EmbeddedCheckoutProviderContext";var Ye=function(){var e=V("calls useStripe()"),t=e.stripe;return t};g("auBankAccount",b);var ie=g("card",b);g("cardNumber",b);g("cardExpiry",b);g("cardCvc",b);g("iban",b);g("payment",b);g("expressCheckout",b);g("paymentRequestButton",b);g("linkAuthentication",b);g("address",b);g("shippingAddress",b);g("paymentMethodMessaging",b);g("taxId",b);const Je=Ee("pk_test_51S82BUI5o9FkSK2kMsxK9NB71cW3RsjF6aeS94NMMCrcQexIt0TCoTV6ebicDvX5SMV0yI8q3XGSWkFJOTZUmOox00oC874Ff3");function He({booking:r,amount:e,intentSecret:t}){const n=Ye(),a=De(),{props:o}=ce(),{auth:p}=o,[d,s]=_.useState(!1),[x,m]=_.useState(""),[v,u]=_.useState(""),[E,j]=_.useState(!1),[S,k]=_.useState(p?.user?.name||""),w=async O=>{if(O.preventDefault(),!n||!a){m("Stripe is not loaded yet.");return}if(!E){m("Please complete the card details.");return}s(!0),m(""),u("");try{const N=a.getElement(ie),{error:I,setupIntent:D}=await n.confirmCardSetup(t,{payment_method:{card:N,billing_details:{name:S,email:p?.user?.email}}});if(I)throw new Error(I.message);const W=await fetch(route("stripe.process"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({payment_method:D.payment_method,booking_id:r?.id})}),A=await W.json();if(!W.ok){if(A.requires_action){const{error:U}=await n.confirmCardPayment(A.payment_intent_client_secret);if(U)throw new Error(U.message);await w(O);return}throw new Error(A.message||"Payment failed")}u("Payment successful! Redirecting..."),setTimeout(()=>{window.location.href=route("bookings.show",r.id)},2e3)}catch(N){m(N.message||"Payment failed"),console.error("Payment error:",N)}finally{s(!1)}};return i.jsx("div",{className:"max-w-2xl mx-auto bg-white shadow-lg rounded-lg overflow-hidden",children:i.jsxs("div",{className:"p-6",children:[i.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Complete Payment"}),r&&i.jsxs("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-100 rounded-lg",children:[i.jsxs("div",{className:"flex justify-between items-center mb-2",children:[i.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Booking Reference:"}),i.jsxs("span",{className:"font-semibold",children:["#",r.id]})]}),i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Total Amount:"}),i.jsxs("span",{className:"text-xl font-bold text-green-600",children:["$",e]})]})]}),x&&i.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded text-red-600 text-sm",children:x}),v&&i.jsx("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded text-green-600 text-sm",children:v}),i.jsx("form",{onSubmit:w,children:i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name on Card"}),i.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md",placeholder:"Enter name as shown on card",value:S,onChange:O=>k(O.target.value),required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Card Details"}),i.jsx("div",{className:"p-3 border border-gray-300 rounded-md bg-white",children:i.jsx(ie,{onChange:O=>j(O.complete),options:{style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"}}}}})})]}),i.jsx("button",{type:"submit",disabled:d||!n||!E,className:"w-full py-3 px-4 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-md disabled:opacity-50 disabled:cursor-not-allowed",children:d?"Processing...":`Pay $${e}`})]})})]})})}function tt({booking:r,amount:e,stripeKey:t,intent:n}){const{props:a}=ce(),{auth:o}=a;return i.jsxs(je,{user:o?.user,header:i.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Payment"}),children:[i.jsx(Ce,{title:"Complete Payment"}),i.jsx("div",{className:"py-12",children:i.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:i.jsx(fe,{stripe:Je,children:i.jsx(He,{booking:r,amount:e,intentSecret:n})})})})]})}export{tt as default};
